{"format_version":"0.1","terraform_version":"0.12.13","variables":{"container_image":{"value":"jnonino/symmetrical-spork:latest"},"container_port":{"value":8080},"log_group_path":{"value":"/ecs/service/spork"},"name_preffix":{"value":"spork"},"profile":{"value":"jnonino"},"region":{"value":"us-east-1"}},"planned_values":{"outputs":{"aws_ecs_service_service_cluster":{"sensitive":false},"aws_ecs_service_service_desired_count":{"sensitive":false,"value":1},"aws_ecs_service_service_id":{"sensitive":false},"aws_ecs_service_service_name":{"sensitive":false,"value":"spork-service"},"ecs_tasks_sg_arn":{"sensitive":false},"ecs_tasks_sg_description":{"sensitive":false,"value":"Allow inbound access from the LB only"},"ecs_tasks_sg_id":{"sensitive":false},"ecs_tasks_sg_name":{"sensitive":false,"value":"spork-ecs-tasks-sg"},"lb_arn":{"sensitive":false},"lb_arn_suffix":{"sensitive":false},"lb_dns_name":{"sensitive":false},"lb_id":{"sensitive":false},"lb_sg_arn":{"sensitive":false},"lb_sg_description":{"sensitive":false,"value":"Control access to LB"},"lb_sg_id":{"sensitive":false},"lb_sg_name":{"sensitive":false,"value":"spork-lb-sg"},"lb_zone_id":{"sensitive":false}},"root_module":{"child_modules":[{"resources":[{"address":"module.aws_cw_logs.aws_cloudwatch_log_group.log_group","mode":"managed","type":"aws_cloudwatch_log_group","name":"log_group","provider_name":"aws","schema_version":0,"values":{"kms_key_id":"","name":"/ecs/service/spork","name_prefix":null,"retention_in_days":30,"tags":null}},{"address":"module.aws_cw_logs.aws_cloudwatch_log_stream.log_stream","mode":"managed","type":"aws_cloudwatch_log_stream","name":"log_stream","provider_name":"aws","schema_version":0,"values":{"log_group_name":"/ecs/service/spork","name":"/ecs/service/spork"}}],"address":"module.aws_cw_logs"},{"resources":[{"address":"module.ecs-cluster.aws_ecs_cluster.cluster","mode":"managed","type":"aws_ecs_cluster","name":"cluster","provider_name":"aws","schema_version":0,"values":{"name":"spork","tags":null}}],"address":"module.ecs-cluster"},{"resources":[{"address":"module.ecs-fargate-service.aws_appautoscaling_policy.scale_down_policy","mode":"managed","type":"aws_appautoscaling_policy","name":"scale_down_policy","provider_name":"aws","schema_version":0,"values":{"adjustment_type":null,"alarms":null,"cooldown":null,"metric_aggregation_type":null,"min_adjustment_magnitude":null,"name":"spork-scale-down-policy","policy_type":"StepScaling","resource_id":"service/spork/spork-service","scalable_dimension":"ecs:service:DesiredCount","service_namespace":"ecs","step_adjustment":[],"step_scaling_policy_configuration":[{"adjustment_type":"ChangeInCapacity","cooldown":60,"metric_aggregation_type":"Maximum","min_adjustment_magnitude":null,"step_adjustment":[{"metric_interval_lower_bound":"0","metric_interval_upper_bound":"","scaling_adjustment":-1}]}],"target_tracking_scaling_policy_configuration":[]}},{"address":"module.ecs-fargate-service.aws_appautoscaling_policy.scale_up_policy","mode":"managed","type":"aws_appautoscaling_policy","name":"scale_up_policy","provider_name":"aws","schema_version":0,"values":{"adjustment_type":null,"alarms":null,"cooldown":null,"metric_aggregation_type":null,"min_adjustment_magnitude":null,"name":"spork-scale-up-policy","policy_type":"StepScaling","resource_id":"service/spork/spork-service","scalable_dimension":"ecs:service:DesiredCount","service_namespace":"ecs","step_adjustment":[],"step_scaling_policy_configuration":[{"adjustment_type":"ChangeInCapacity","cooldown":60,"metric_aggregation_type":"Maximum","min_adjustment_magnitude":null,"step_adjustment":[{"metric_interval_lower_bound":"0","metric_interval_upper_bound":"","scaling_adjustment":1}]}],"target_tracking_scaling_policy_configuration":[]}},{"address":"module.ecs-fargate-service.aws_appautoscaling_target.scale_target","mode":"managed","type":"aws_appautoscaling_target","name":"scale_target","provider_name":"aws","schema_version":0,"values":{"max_capacity":5,"min_capacity":1,"resource_id":"service/spork/spork-service","scalable_dimension":"ecs:service:DesiredCount","service_namespace":"ecs"}},{"address":"module.ecs-fargate-service.aws_cloudwatch_metric_alarm.cpu_high","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"cpu_high","provider_name":"aws","schema_version":1,"values":{"actions_enabled":true,"alarm_description":null,"alarm_name":"spork-cpu-high","comparison_operator":"GreaterThanOrEqualToThreshold","datapoints_to_alarm":null,"dimensions":{"ClusterName":"spork","ServiceName":"spork-service"},"evaluation_periods":3,"extended_statistic":null,"insufficient_data_actions":null,"metric_name":"CPUUtilization","metric_query":[],"namespace":"AWS/ECS","ok_actions":null,"period":60,"statistic":"Maximum","tags":null,"threshold":85,"treat_missing_data":"missing","unit":null}},{"address":"module.ecs-fargate-service.aws_cloudwatch_metric_alarm.cpu_low","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"cpu_low","provider_name":"aws","schema_version":1,"values":{"actions_enabled":true,"alarm_description":null,"alarm_name":"spork-cpu-low","comparison_operator":"LessThanOrEqualToThreshold","datapoints_to_alarm":null,"dimensions":{"ClusterName":"spork","ServiceName":"spork-service"},"evaluation_periods":3,"extended_statistic":null,"insufficient_data_actions":null,"metric_name":"CPUUtilization","metric_query":[],"namespace":"AWS/ECS","ok_actions":null,"period":60,"statistic":"Average","tags":null,"threshold":10,"treat_missing_data":"missing","unit":null}},{"address":"module.ecs-fargate-service.aws_ecs_service.service","mode":"managed","type":"aws_ecs_service","name":"service","provider_name":"aws","schema_version":0,"values":{"deployment_controller":[],"deployment_maximum_percent":200,"deployment_minimum_healthy_percent":100,"desired_count":1,"enable_ecs_managed_tags":false,"health_check_grace_period_seconds":20,"launch_type":"FARGATE","load_balancer":[{"container_name":"spork","container_port":8080,"elb_name":""}],"name":"spork-service","network_configuration":[{"assign_public_ip":false}],"ordered_placement_strategy":[],"placement_constraints":[],"platform_version":"LATEST","propagate_tags":"SERVICE","scheduling_strategy":"REPLICA","service_registries":[],"tags":null}},{"address":"module.ecs-fargate-service.aws_iam_role.ecs_autoscale_role","mode":"managed","type":"aws_iam_role","name":"ecs_autoscale_role","provider_name":"aws","schema_version":0,"values":{"assume_role_policy":"{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"Service\": \"application-autoscaling.amazonaws.com\"\n            },\n            \"Action\": \"sts:AssumeRole\"\n        }\n    ]\n}\n","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"spork-ecs-autoscale-role","name_prefix":null,"path":"/","permissions_boundary":null,"tags":null}},{"address":"module.ecs-fargate-service.aws_iam_role_policy.ecs_autoscale_role_policy","mode":"managed","type":"aws_iam_role_policy","name":"ecs_autoscale_role_policy","provider_name":"aws","schema_version":0,"values":{"name":"spork-ecs-autoscale-role-policy","name_prefix":null,"policy":"{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ecs:DescribeServices\",\n                \"ecs:UpdateService\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ]\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"cloudwatch:DescribeAlarms\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ]\n        }\n    ]\n}\n"}},{"address":"module.ecs-fargate-service.aws_kms_key.encryption_key","mode":"managed","type":"aws_kms_key","name":"encryption_key","provider_name":"aws","schema_version":0,"values":{"deletion_window_in_days":null,"description":"spork ECS Encryption Key","enable_key_rotation":true,"is_enabled":true,"tags":null}},{"address":"module.ecs-fargate-service.aws_lb.lb","mode":"managed","type":"aws_lb","name":"lb","provider_name":"aws","schema_version":0,"values":{"access_logs":[],"enable_cross_zone_load_balancing":null,"enable_deletion_protection":false,"enable_http2":true,"idle_timeout":60,"internal":false,"load_balancer_type":"application","name":"spork-lb","name_prefix":null,"tags":{"Name":"spork-lb"},"timeouts":null}},{"address":"module.ecs-fargate-service.aws_lb_listener.listener","mode":"managed","type":"aws_lb_listener","name":"listener","provider_name":"aws","schema_version":0,"values":{"certificate_arn":null,"default_action":[{"authenticate_cognito":[],"authenticate_oidc":[],"fixed_response":[],"redirect":[],"type":"forward"}],"port":80,"protocol":"HTTP","timeouts":null}},{"address":"module.ecs-fargate-service.aws_lb_target_group.lb_tg","mode":"managed","type":"aws_lb_target_group","name":"lb_tg","provider_name":"aws","schema_version":0,"values":{"deregistration_delay":300,"health_check":[{"enabled":true,"healthy_threshold":3,"interval":30,"path":"/","port":"8080","protocol":"HTTP","unhealthy_threshold":3}],"lambda_multi_value_headers_enabled":false,"name":"spork-lb-tg","name_prefix":null,"port":8080,"protocol":"HTTP","proxy_protocol_v2":false,"slow_start":0,"tags":{"Name":"spork-lb-tg"},"target_type":"ip"}},{"address":"module.ecs-fargate-service.aws_security_group.ecs_tasks_sg","mode":"managed","type":"aws_security_group","name":"ecs_tasks_sg","provider_name":"aws","schema_version":1,"values":{"description":"Allow inbound access from the LB only","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"ingress":[{"cidr_blocks":[],"description":"","from_port":8080,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","self":false,"to_port":8080}],"name":"spork-ecs-tasks-sg","name_prefix":null,"revoke_rules_on_delete":false,"tags":{"Name":"spork-ecs-tasks-sg"},"timeouts":null}},{"address":"module.ecs-fargate-service.aws_security_group.lb_sg","mode":"managed","type":"aws_security_group","name":"lb_sg","provider_name":"aws","schema_version":1,"values":{"description":"Control access to LB","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"ingress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":80,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":80}],"name":"spork-lb-sg","name_prefix":null,"revoke_rules_on_delete":false,"tags":{"Name":"spork-lb-sg"},"timeouts":null}}],"address":"module.ecs-fargate-service"},{"resources":[{"address":"module.networking.aws_eip.nat_eip[0]","mode":"managed","type":"aws_eip","name":"nat_eip","index":0,"provider_name":"aws","schema_version":0,"values":{"associate_with_private_ip":null,"tags":{"Name":"spork-nat-eip-us-east-1a"},"timeouts":null,"vpc":true}},{"address":"module.networking.aws_eip.nat_eip[1]","mode":"managed","type":"aws_eip","name":"nat_eip","index":1,"provider_name":"aws","schema_version":0,"values":{"associate_with_private_ip":null,"tags":{"Name":"spork-nat-eip-us-east-1b"},"timeouts":null,"vpc":true}},{"address":"module.networking.aws_eip.nat_eip[2]","mode":"managed","type":"aws_eip","name":"nat_eip","index":2,"provider_name":"aws","schema_version":0,"values":{"associate_with_private_ip":null,"tags":{"Name":"spork-nat-eip-us-east-1c"},"timeouts":null,"vpc":true}},{"address":"module.networking.aws_eip.nat_eip[3]","mode":"managed","type":"aws_eip","name":"nat_eip","index":3,"provider_name":"aws","schema_version":0,"values":{"associate_with_private_ip":null,"tags":{"Name":"spork-nat-eip-us-east-1d"},"timeouts":null,"vpc":true}},{"address":"module.networking.aws_internet_gateway.internet_gw","mode":"managed","type":"aws_internet_gateway","name":"internet_gw","provider_name":"aws","schema_version":0,"values":{"tags":{"Name":"spork-internet-gw"}}},{"address":"module.networking.aws_nat_gateway.nat_gw[0]","mode":"managed","type":"aws_nat_gateway","name":"nat_gw","index":0,"provider_name":"aws","schema_version":0,"values":{"tags":{"Name":"spork-nat-gw-us-east-1a"}}},{"address":"module.networking.aws_nat_gateway.nat_gw[1]","mode":"managed","type":"aws_nat_gateway","name":"nat_gw","index":1,"provider_name":"aws","schema_version":0,"values":{"tags":{"Name":"spork-nat-gw-us-east-1b"}}},{"address":"module.networking.aws_nat_gateway.nat_gw[2]","mode":"managed","type":"aws_nat_gateway","name":"nat_gw","index":2,"provider_name":"aws","schema_version":0,"values":{"tags":{"Name":"spork-nat-gw-us-east-1c"}}},{"address":"module.networking.aws_nat_gateway.nat_gw[3]","mode":"managed","type":"aws_nat_gateway","name":"nat_gw","index":3,"provider_name":"aws","schema_version":0,"values":{"tags":{"Name":"spork-nat-gw-us-east-1d"}}},{"address":"module.networking.aws_route.private_internet_route[0]","mode":"managed","type":"aws_route","name":"private_internet_route","index":0,"provider_name":"aws","schema_version":0,"values":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"timeouts":null,"transit_gateway_id":null,"vpc_peering_connection_id":null}},{"address":"module.networking.aws_route.private_internet_route[1]","mode":"managed","type":"aws_route","name":"private_internet_route","index":1,"provider_name":"aws","schema_version":0,"values":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"timeouts":null,"transit_gateway_id":null,"vpc_peering_connection_id":null}},{"address":"module.networking.aws_route.private_internet_route[2]","mode":"managed","type":"aws_route","name":"private_internet_route","index":2,"provider_name":"aws","schema_version":0,"values":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"timeouts":null,"transit_gateway_id":null,"vpc_peering_connection_id":null}},{"address":"module.networking.aws_route.private_internet_route[3]","mode":"managed","type":"aws_route","name":"private_internet_route","index":3,"provider_name":"aws","schema_version":0,"values":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"timeouts":null,"transit_gateway_id":null,"vpc_peering_connection_id":null}},{"address":"module.networking.aws_route.public_internet_route[0]","mode":"managed","type":"aws_route","name":"public_internet_route","index":0,"provider_name":"aws","schema_version":0,"values":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"timeouts":null,"transit_gateway_id":null,"vpc_peering_connection_id":null}},{"address":"module.networking.aws_route.public_internet_route[1]","mode":"managed","type":"aws_route","name":"public_internet_route","index":1,"provider_name":"aws","schema_version":0,"values":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"timeouts":null,"transit_gateway_id":null,"vpc_peering_connection_id":null}},{"address":"module.networking.aws_route.public_internet_route[2]","mode":"managed","type":"aws_route","name":"public_internet_route","index":2,"provider_name":"aws","schema_version":0,"values":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"timeouts":null,"transit_gateway_id":null,"vpc_peering_connection_id":null}},{"address":"module.networking.aws_route.public_internet_route[3]","mode":"managed","type":"aws_route","name":"public_internet_route","index":3,"provider_name":"aws","schema_version":0,"values":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"timeouts":null,"transit_gateway_id":null,"vpc_peering_connection_id":null}},{"address":"module.networking.aws_route_table.private_subnets_route_table[0]","mode":"managed","type":"aws_route_table","name":"private_subnets_route_table","index":0,"provider_name":"aws","schema_version":0,"values":{"tags":{"Name":"spork-private-rt-us-east-1a"}}},{"address":"module.networking.aws_route_table.private_subnets_route_table[1]","mode":"managed","type":"aws_route_table","name":"private_subnets_route_table","index":1,"provider_name":"aws","schema_version":0,"values":{"tags":{"Name":"spork-private-rt-us-east-1b"}}},{"address":"module.networking.aws_route_table.private_subnets_route_table[2]","mode":"managed","type":"aws_route_table","name":"private_subnets_route_table","index":2,"provider_name":"aws","schema_version":0,"values":{"tags":{"Name":"spork-private-rt-us-east-1c"}}},{"address":"module.networking.aws_route_table.private_subnets_route_table[3]","mode":"managed","type":"aws_route_table","name":"private_subnets_route_table","index":3,"provider_name":"aws","schema_version":0,"values":{"tags":{"Name":"spork-private-rt-us-east-1d"}}},{"address":"module.networking.aws_route_table.public_subnets_route_table[0]","mode":"managed","type":"aws_route_table","name":"public_subnets_route_table","index":0,"provider_name":"aws","schema_version":0,"values":{"tags":{"Name":"spork-public-rt-us-east-1a"}}},{"address":"module.networking.aws_route_table.public_subnets_route_table[1]","mode":"managed","type":"aws_route_table","name":"public_subnets_route_table","index":1,"provider_name":"aws","schema_version":0,"values":{"tags":{"Name":"spork-public-rt-us-east-1b"}}},{"address":"module.networking.aws_route_table.public_subnets_route_table[2]","mode":"managed","type":"aws_route_table","name":"public_subnets_route_table","index":2,"provider_name":"aws","schema_version":0,"values":{"tags":{"Name":"spork-public-rt-us-east-1c"}}},{"address":"module.networking.aws_route_table.public_subnets_route_table[3]","mode":"managed","type":"aws_route_table","name":"public_subnets_route_table","index":3,"provider_name":"aws","schema_version":0,"values":{"tags":{"Name":"spork-public-rt-us-east-1d"}}},{"address":"module.networking.aws_route_table_association.private_internet_route_table_associations[0]","mode":"managed","type":"aws_route_table_association","name":"private_internet_route_table_associations","index":0,"provider_name":"aws","schema_version":0},{"address":"module.networking.aws_route_table_association.private_internet_route_table_associations[1]","mode":"managed","type":"aws_route_table_association","name":"private_internet_route_table_associations","index":1,"provider_name":"aws","schema_version":0},{"address":"module.networking.aws_route_table_association.private_internet_route_table_associations[2]","mode":"managed","type":"aws_route_table_association","name":"private_internet_route_table_associations","index":2,"provider_name":"aws","schema_version":0},{"address":"module.networking.aws_route_table_association.private_internet_route_table_associations[3]","mode":"managed","type":"aws_route_table_association","name":"private_internet_route_table_associations","index":3,"provider_name":"aws","schema_version":0},{"address":"module.networking.aws_route_table_association.public_internet_route_table_associations[0]","mode":"managed","type":"aws_route_table_association","name":"public_internet_route_table_associations","index":0,"provider_name":"aws","schema_version":0},{"address":"module.networking.aws_route_table_association.public_internet_route_table_associations[1]","mode":"managed","type":"aws_route_table_association","name":"public_internet_route_table_associations","index":1,"provider_name":"aws","schema_version":0},{"address":"module.networking.aws_route_table_association.public_internet_route_table_associations[2]","mode":"managed","type":"aws_route_table_association","name":"public_internet_route_table_associations","index":2,"provider_name":"aws","schema_version":0},{"address":"module.networking.aws_route_table_association.public_internet_route_table_associations[3]","mode":"managed","type":"aws_route_table_association","name":"public_internet_route_table_associations","index":3,"provider_name":"aws","schema_version":0},{"address":"module.networking.aws_subnet.private_subnets[0]","mode":"managed","type":"aws_subnet","name":"private_subnets","index":0,"provider_name":"aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1a","cidr_block":"192.168.128.0/19","map_public_ip_on_launch":false,"tags":{"Name":"spork-private-net-us-east-1a"},"timeouts":null}},{"address":"module.networking.aws_subnet.private_subnets[1]","mode":"managed","type":"aws_subnet","name":"private_subnets","index":1,"provider_name":"aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1b","cidr_block":"192.168.160.0/19","map_public_ip_on_launch":false,"tags":{"Name":"spork-private-net-us-east-1b"},"timeouts":null}},{"address":"module.networking.aws_subnet.private_subnets[2]","mode":"managed","type":"aws_subnet","name":"private_subnets","index":2,"provider_name":"aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1c","cidr_block":"192.168.192.0/19","map_public_ip_on_launch":false,"tags":{"Name":"spork-private-net-us-east-1c"},"timeouts":null}},{"address":"module.networking.aws_subnet.private_subnets[3]","mode":"managed","type":"aws_subnet","name":"private_subnets","index":3,"provider_name":"aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1d","cidr_block":"192.168.224.0/19","map_public_ip_on_launch":false,"tags":{"Name":"spork-private-net-us-east-1d"},"timeouts":null}},{"address":"module.networking.aws_subnet.public_subnets[0]","mode":"managed","type":"aws_subnet","name":"public_subnets","index":0,"provider_name":"aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1a","cidr_block":"192.168.0.0/19","map_public_ip_on_launch":true,"tags":{"Name":"spork-public-net-us-east-1a"},"timeouts":null}},{"address":"module.networking.aws_subnet.public_subnets[1]","mode":"managed","type":"aws_subnet","name":"public_subnets","index":1,"provider_name":"aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1b","cidr_block":"192.168.32.0/19","map_public_ip_on_launch":true,"tags":{"Name":"spork-public-net-us-east-1b"},"timeouts":null}},{"address":"module.networking.aws_subnet.public_subnets[2]","mode":"managed","type":"aws_subnet","name":"public_subnets","index":2,"provider_name":"aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1c","cidr_block":"192.168.64.0/19","map_public_ip_on_launch":true,"tags":{"Name":"spork-public-net-us-east-1c"},"timeouts":null}},{"address":"module.networking.aws_subnet.public_subnets[3]","mode":"managed","type":"aws_subnet","name":"public_subnets","index":3,"provider_name":"aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1d","cidr_block":"192.168.96.0/19","map_public_ip_on_launch":true,"tags":{"Name":"spork-public-net-us-east-1d"},"timeouts":null}},{"address":"module.networking.aws_vpc.vpc","mode":"managed","type":"aws_vpc","name":"vpc","provider_name":"aws","schema_version":1,"values":{"assign_generated_ipv6_cidr_block":false,"cidr_block":"192.168.0.0/16","enable_dns_hostnames":true,"enable_dns_support":true,"instance_tenancy":"default","tags":{"Name":"spork-vpc"}}}],"address":"module.networking"},{"resources":[{"address":"module.td.aws_ecs_task_definition.td","mode":"managed","type":"aws_ecs_task_definition","name":"td","provider_name":"aws","schema_version":1,"values":{"container_definitions":"[{\"command\":null,\"cpu\":1024,\"dependsOn\":null,\"dnsServers\":null,\"dockerLabels\":null,\"entryPoint\":null,\"environment\":null,\"essential\":true,\"firelensConfiguration\":null,\"healthCheck\":{\"command\":[\"CMD-SHELL\",\"curl -f http://localhost:8080/__healthcheck__ || exit 1\"],\"interval\":30,\"retries\":3,\"startPeriod\":20,\"timeout\":5},\"image\":\"jnonino/symmetrical-spork:latest\",\"links\":null,\"logConfiguration\":{\"logDriver\":\"awslogs\",\"options\":{\"awslogs-group\":\"/ecs/service/spork\",\"awslogs-region\":\"us-east-1\",\"awslogs-stream-prefix\":\"ecs\"},\"secretOptions\":null},\"memory\":8192,\"memoryReservation\":2048,\"mountPoints\":null,\"name\":\"spork\",\"portMappings\":[{\"containerPort\":8080,\"hostPort\":8080,\"protocol\":\"HTTP\"}],\"privileged\":null,\"readonlyRootFilesystem\":false,\"repositoryCredentials\":null,\"secrets\":null,\"startTimeout\":30,\"stopTimeout\":30,\"systemControls\":null,\"ulimits\":null,\"user\":null,\"volumesFrom\":null,\"workingDirectory\":null}]","cpu":"1024","family":"spork-td","ipc_mode":null,"memory":"8192","network_mode":"awsvpc","pid_mode":null,"placement_constraints":[],"proxy_configuration":[],"requires_compatibilities":["FARGATE"],"tags":null,"volume":[]}},{"address":"module.td.aws_iam_role.ecs_task_execution_role","mode":"managed","type":"aws_iam_role","name":"ecs_task_execution_role","provider_name":"aws","schema_version":0,"values":{"assume_role_policy":"{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"Service\": \"ecs-tasks.amazonaws.com\"\n            },\n            \"Action\": \"sts:AssumeRole\",\n            \"Sid\": \"\"\n        }\n    ]\n}\n","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"spork-ecs-task-execution-role","name_prefix":null,"path":"/","permissions_boundary":null,"tags":null}},{"address":"module.td.aws_iam_role_policy_attachment.ecs_task_execution_role_policy_attach","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ecs_task_execution_role_policy_attach","provider_name":"aws","schema_version":0,"values":{"policy_arn":"arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy","role":"spork-ecs-task-execution-role"}}],"address":"module.td"}]}},"resource_changes":[{"address":"module.aws_cw_logs.aws_cloudwatch_log_group.log_group","module_address":"module.aws_cw_logs","mode":"managed","type":"aws_cloudwatch_log_group","name":"log_group","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"kms_key_id":"","name":"/ecs/service/spork","name_prefix":null,"retention_in_days":30,"tags":null},"after_unknown":{"arn":true,"id":true}}},{"address":"module.aws_cw_logs.aws_cloudwatch_log_stream.log_stream","module_address":"module.aws_cw_logs","mode":"managed","type":"aws_cloudwatch_log_stream","name":"log_stream","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"log_group_name":"/ecs/service/spork","name":"/ecs/service/spork"},"after_unknown":{"arn":true,"id":true}}},{"address":"module.ecs-cluster.aws_ecs_cluster.cluster","module_address":"module.ecs-cluster","mode":"managed","type":"aws_ecs_cluster","name":"cluster","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"name":"spork","tags":null},"after_unknown":{"arn":true,"id":true,"setting":true}}},{"address":"module.ecs-fargate-service.aws_appautoscaling_policy.scale_down_policy","module_address":"module.ecs-fargate-service","mode":"managed","type":"aws_appautoscaling_policy","name":"scale_down_policy","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"adjustment_type":null,"alarms":null,"cooldown":null,"metric_aggregation_type":null,"min_adjustment_magnitude":null,"name":"spork-scale-down-policy","policy_type":"StepScaling","resource_id":"service/spork/spork-service","scalable_dimension":"ecs:service:DesiredCount","service_namespace":"ecs","step_adjustment":[],"step_scaling_policy_configuration":[{"adjustment_type":"ChangeInCapacity","cooldown":60,"metric_aggregation_type":"Maximum","min_adjustment_magnitude":null,"step_adjustment":[{"metric_interval_lower_bound":"0","metric_interval_upper_bound":"","scaling_adjustment":-1}]}],"target_tracking_scaling_policy_configuration":[]},"after_unknown":{"arn":true,"id":true,"step_adjustment":[],"step_scaling_policy_configuration":[{"step_adjustment":[{}]}],"target_tracking_scaling_policy_configuration":[]}}},{"address":"module.ecs-fargate-service.aws_appautoscaling_policy.scale_up_policy","module_address":"module.ecs-fargate-service","mode":"managed","type":"aws_appautoscaling_policy","name":"scale_up_policy","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"adjustment_type":null,"alarms":null,"cooldown":null,"metric_aggregation_type":null,"min_adjustment_magnitude":null,"name":"spork-scale-up-policy","policy_type":"StepScaling","resource_id":"service/spork/spork-service","scalable_dimension":"ecs:service:DesiredCount","service_namespace":"ecs","step_adjustment":[],"step_scaling_policy_configuration":[{"adjustment_type":"ChangeInCapacity","cooldown":60,"metric_aggregation_type":"Maximum","min_adjustment_magnitude":null,"step_adjustment":[{"metric_interval_lower_bound":"0","metric_interval_upper_bound":"","scaling_adjustment":1}]}],"target_tracking_scaling_policy_configuration":[]},"after_unknown":{"arn":true,"id":true,"step_adjustment":[],"step_scaling_policy_configuration":[{"step_adjustment":[{}]}],"target_tracking_scaling_policy_configuration":[]}}},{"address":"module.ecs-fargate-service.aws_appautoscaling_target.scale_target","module_address":"module.ecs-fargate-service","mode":"managed","type":"aws_appautoscaling_target","name":"scale_target","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"max_capacity":5,"min_capacity":1,"resource_id":"service/spork/spork-service","scalable_dimension":"ecs:service:DesiredCount","service_namespace":"ecs"},"after_unknown":{"id":true,"role_arn":true}}},{"address":"module.ecs-fargate-service.aws_cloudwatch_metric_alarm.cpu_high","module_address":"module.ecs-fargate-service","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"cpu_high","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"actions_enabled":true,"alarm_description":null,"alarm_name":"spork-cpu-high","comparison_operator":"GreaterThanOrEqualToThreshold","datapoints_to_alarm":null,"dimensions":{"ClusterName":"spork","ServiceName":"spork-service"},"evaluation_periods":3,"extended_statistic":null,"insufficient_data_actions":null,"metric_name":"CPUUtilization","metric_query":[],"namespace":"AWS/ECS","ok_actions":null,"period":60,"statistic":"Maximum","tags":null,"threshold":85,"treat_missing_data":"missing","unit":null},"after_unknown":{"alarm_actions":true,"arn":true,"dimensions":{},"evaluate_low_sample_count_percentiles":true,"id":true,"metric_query":[]}}},{"address":"module.ecs-fargate-service.aws_cloudwatch_metric_alarm.cpu_low","module_address":"module.ecs-fargate-service","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"cpu_low","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"actions_enabled":true,"alarm_description":null,"alarm_name":"spork-cpu-low","comparison_operator":"LessThanOrEqualToThreshold","datapoints_to_alarm":null,"dimensions":{"ClusterName":"spork","ServiceName":"spork-service"},"evaluation_periods":3,"extended_statistic":null,"insufficient_data_actions":null,"metric_name":"CPUUtilization","metric_query":[],"namespace":"AWS/ECS","ok_actions":null,"period":60,"statistic":"Average","tags":null,"threshold":10,"treat_missing_data":"missing","unit":null},"after_unknown":{"alarm_actions":true,"arn":true,"dimensions":{},"evaluate_low_sample_count_percentiles":true,"id":true,"metric_query":[]}}},{"address":"module.ecs-fargate-service.aws_ecs_service.service","module_address":"module.ecs-fargate-service","mode":"managed","type":"aws_ecs_service","name":"service","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"deployment_controller":[],"deployment_maximum_percent":200,"deployment_minimum_healthy_percent":100,"desired_count":1,"enable_ecs_managed_tags":false,"health_check_grace_period_seconds":20,"launch_type":"FARGATE","load_balancer":[{"container_name":"spork","container_port":8080,"elb_name":""}],"name":"spork-service","network_configuration":[{"assign_public_ip":false}],"ordered_placement_strategy":[],"placement_constraints":[],"platform_version":"LATEST","propagate_tags":"SERVICE","scheduling_strategy":"REPLICA","service_registries":[],"tags":null},"after_unknown":{"cluster":true,"deployment_controller":[],"iam_role":true,"id":true,"load_balancer":[{"target_group_arn":true}],"network_configuration":[{"security_groups":true,"subnets":true}],"ordered_placement_strategy":[],"placement_constraints":[],"placement_strategy":true,"service_registries":[],"task_definition":true}}},{"address":"module.ecs-fargate-service.aws_iam_role.ecs_autoscale_role","module_address":"module.ecs-fargate-service","mode":"managed","type":"aws_iam_role","name":"ecs_autoscale_role","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"Service\": \"application-autoscaling.amazonaws.com\"\n            },\n            \"Action\": \"sts:AssumeRole\"\n        }\n    ]\n}\n","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"spork-ecs-autoscale-role","name_prefix":null,"path":"/","permissions_boundary":null,"tags":null},"after_unknown":{"arn":true,"create_date":true,"id":true,"unique_id":true}}},{"address":"module.ecs-fargate-service.aws_iam_role_policy.ecs_autoscale_role_policy","module_address":"module.ecs-fargate-service","mode":"managed","type":"aws_iam_role_policy","name":"ecs_autoscale_role_policy","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"name":"spork-ecs-autoscale-role-policy","name_prefix":null,"policy":"{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ecs:DescribeServices\",\n                \"ecs:UpdateService\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ]\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"cloudwatch:DescribeAlarms\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ]\n        }\n    ]\n}\n"},"after_unknown":{"id":true,"role":true}}},{"address":"module.ecs-fargate-service.aws_kms_key.encryption_key","module_address":"module.ecs-fargate-service","mode":"managed","type":"aws_kms_key","name":"encryption_key","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"deletion_window_in_days":null,"description":"spork ECS Encryption Key","enable_key_rotation":true,"is_enabled":true,"tags":null},"after_unknown":{"arn":true,"id":true,"key_id":true,"key_usage":true,"policy":true}}},{"address":"module.ecs-fargate-service.aws_lb.lb","module_address":"module.ecs-fargate-service","mode":"managed","type":"aws_lb","name":"lb","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"access_logs":[],"enable_cross_zone_load_balancing":null,"enable_deletion_protection":false,"enable_http2":true,"idle_timeout":60,"internal":false,"load_balancer_type":"application","name":"spork-lb","name_prefix":null,"tags":{"Name":"spork-lb"},"timeouts":null},"after_unknown":{"access_logs":[],"arn":true,"arn_suffix":true,"dns_name":true,"id":true,"ip_address_type":true,"security_groups":true,"subnet_mapping":true,"subnets":true,"tags":{},"vpc_id":true,"zone_id":true}}},{"address":"module.ecs-fargate-service.aws_lb_listener.listener","module_address":"module.ecs-fargate-service","mode":"managed","type":"aws_lb_listener","name":"listener","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"certificate_arn":null,"default_action":[{"authenticate_cognito":[],"authenticate_oidc":[],"fixed_response":[],"redirect":[],"type":"forward"}],"port":80,"protocol":"HTTP","timeouts":null},"after_unknown":{"arn":true,"default_action":[{"authenticate_cognito":[],"authenticate_oidc":[],"fixed_response":[],"order":true,"redirect":[],"target_group_arn":true}],"id":true,"load_balancer_arn":true,"ssl_policy":true}}},{"address":"module.ecs-fargate-service.aws_lb_target_group.lb_tg","module_address":"module.ecs-fargate-service","mode":"managed","type":"aws_lb_target_group","name":"lb_tg","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"deregistration_delay":300,"health_check":[{"enabled":true,"healthy_threshold":3,"interval":30,"path":"/","port":"8080","protocol":"HTTP","unhealthy_threshold":3}],"lambda_multi_value_headers_enabled":false,"name":"spork-lb-tg","name_prefix":null,"port":8080,"protocol":"HTTP","proxy_protocol_v2":false,"slow_start":0,"tags":{"Name":"spork-lb-tg"},"target_type":"ip"},"after_unknown":{"arn":true,"arn_suffix":true,"health_check":[{"matcher":true,"timeout":true}],"id":true,"stickiness":true,"tags":{},"vpc_id":true}}},{"address":"module.ecs-fargate-service.aws_security_group.ecs_tasks_sg","module_address":"module.ecs-fargate-service","mode":"managed","type":"aws_security_group","name":"ecs_tasks_sg","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"description":"Allow inbound access from the LB only","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"ingress":[{"cidr_blocks":[],"description":"","from_port":8080,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","self":false,"to_port":8080}],"name":"spork-ecs-tasks-sg","name_prefix":null,"revoke_rules_on_delete":false,"tags":{"Name":"spork-ecs-tasks-sg"},"timeouts":null},"after_unknown":{"arn":true,"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"id":true,"ingress":[{"cidr_blocks":[],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":true}],"owner_id":true,"tags":{},"vpc_id":true}}},{"address":"module.ecs-fargate-service.aws_security_group.lb_sg","module_address":"module.ecs-fargate-service","mode":"managed","type":"aws_security_group","name":"lb_sg","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"description":"Control access to LB","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"ingress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":80,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":80}],"name":"spork-lb-sg","name_prefix":null,"revoke_rules_on_delete":false,"tags":{"Name":"spork-lb-sg"},"timeouts":null},"after_unknown":{"arn":true,"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"id":true,"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"owner_id":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_eip.nat_eip[0]","module_address":"module.networking","mode":"managed","type":"aws_eip","name":"nat_eip","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"associate_with_private_ip":null,"tags":{"Name":"spork-nat-eip-us-east-1a"},"timeouts":null,"vpc":true},"after_unknown":{"allocation_id":true,"association_id":true,"domain":true,"id":true,"instance":true,"network_interface":true,"private_dns":true,"private_ip":true,"public_dns":true,"public_ip":true,"public_ipv4_pool":true,"tags":{}}}},{"address":"module.networking.aws_eip.nat_eip[1]","module_address":"module.networking","mode":"managed","type":"aws_eip","name":"nat_eip","index":1,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"associate_with_private_ip":null,"tags":{"Name":"spork-nat-eip-us-east-1b"},"timeouts":null,"vpc":true},"after_unknown":{"allocation_id":true,"association_id":true,"domain":true,"id":true,"instance":true,"network_interface":true,"private_dns":true,"private_ip":true,"public_dns":true,"public_ip":true,"public_ipv4_pool":true,"tags":{}}}},{"address":"module.networking.aws_eip.nat_eip[2]","module_address":"module.networking","mode":"managed","type":"aws_eip","name":"nat_eip","index":2,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"associate_with_private_ip":null,"tags":{"Name":"spork-nat-eip-us-east-1c"},"timeouts":null,"vpc":true},"after_unknown":{"allocation_id":true,"association_id":true,"domain":true,"id":true,"instance":true,"network_interface":true,"private_dns":true,"private_ip":true,"public_dns":true,"public_ip":true,"public_ipv4_pool":true,"tags":{}}}},{"address":"module.networking.aws_eip.nat_eip[3]","module_address":"module.networking","mode":"managed","type":"aws_eip","name":"nat_eip","index":3,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"associate_with_private_ip":null,"tags":{"Name":"spork-nat-eip-us-east-1d"},"timeouts":null,"vpc":true},"after_unknown":{"allocation_id":true,"association_id":true,"domain":true,"id":true,"instance":true,"network_interface":true,"private_dns":true,"private_ip":true,"public_dns":true,"public_ip":true,"public_ipv4_pool":true,"tags":{}}}},{"address":"module.networking.aws_internet_gateway.internet_gw","module_address":"module.networking","mode":"managed","type":"aws_internet_gateway","name":"internet_gw","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"spork-internet-gw"}},"after_unknown":{"id":true,"owner_id":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_nat_gateway.nat_gw[0]","module_address":"module.networking","mode":"managed","type":"aws_nat_gateway","name":"nat_gw","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"spork-nat-gw-us-east-1a"}},"after_unknown":{"allocation_id":true,"id":true,"network_interface_id":true,"private_ip":true,"public_ip":true,"subnet_id":true,"tags":{}}}},{"address":"module.networking.aws_nat_gateway.nat_gw[1]","module_address":"module.networking","mode":"managed","type":"aws_nat_gateway","name":"nat_gw","index":1,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"spork-nat-gw-us-east-1b"}},"after_unknown":{"allocation_id":true,"id":true,"network_interface_id":true,"private_ip":true,"public_ip":true,"subnet_id":true,"tags":{}}}},{"address":"module.networking.aws_nat_gateway.nat_gw[2]","module_address":"module.networking","mode":"managed","type":"aws_nat_gateway","name":"nat_gw","index":2,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"spork-nat-gw-us-east-1c"}},"after_unknown":{"allocation_id":true,"id":true,"network_interface_id":true,"private_ip":true,"public_ip":true,"subnet_id":true,"tags":{}}}},{"address":"module.networking.aws_nat_gateway.nat_gw[3]","module_address":"module.networking","mode":"managed","type":"aws_nat_gateway","name":"nat_gw","index":3,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"spork-nat-gw-us-east-1d"}},"after_unknown":{"allocation_id":true,"id":true,"network_interface_id":true,"private_ip":true,"public_ip":true,"subnet_id":true,"tags":{}}}},{"address":"module.networking.aws_route.private_internet_route[0]","module_address":"module.networking","mode":"managed","type":"aws_route","name":"private_internet_route","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"timeouts":null,"transit_gateway_id":null,"vpc_peering_connection_id":null},"after_unknown":{"destination_prefix_list_id":true,"egress_only_gateway_id":true,"gateway_id":true,"id":true,"instance_id":true,"instance_owner_id":true,"nat_gateway_id":true,"network_interface_id":true,"origin":true,"route_table_id":true,"state":true}}},{"address":"module.networking.aws_route.private_internet_route[1]","module_address":"module.networking","mode":"managed","type":"aws_route","name":"private_internet_route","index":1,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"timeouts":null,"transit_gateway_id":null,"vpc_peering_connection_id":null},"after_unknown":{"destination_prefix_list_id":true,"egress_only_gateway_id":true,"gateway_id":true,"id":true,"instance_id":true,"instance_owner_id":true,"nat_gateway_id":true,"network_interface_id":true,"origin":true,"route_table_id":true,"state":true}}},{"address":"module.networking.aws_route.private_internet_route[2]","module_address":"module.networking","mode":"managed","type":"aws_route","name":"private_internet_route","index":2,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"timeouts":null,"transit_gateway_id":null,"vpc_peering_connection_id":null},"after_unknown":{"destination_prefix_list_id":true,"egress_only_gateway_id":true,"gateway_id":true,"id":true,"instance_id":true,"instance_owner_id":true,"nat_gateway_id":true,"network_interface_id":true,"origin":true,"route_table_id":true,"state":true}}},{"address":"module.networking.aws_route.private_internet_route[3]","module_address":"module.networking","mode":"managed","type":"aws_route","name":"private_internet_route","index":3,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"timeouts":null,"transit_gateway_id":null,"vpc_peering_connection_id":null},"after_unknown":{"destination_prefix_list_id":true,"egress_only_gateway_id":true,"gateway_id":true,"id":true,"instance_id":true,"instance_owner_id":true,"nat_gateway_id":true,"network_interface_id":true,"origin":true,"route_table_id":true,"state":true}}},{"address":"module.networking.aws_route.public_internet_route[0]","module_address":"module.networking","mode":"managed","type":"aws_route","name":"public_internet_route","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"timeouts":null,"transit_gateway_id":null,"vpc_peering_connection_id":null},"after_unknown":{"destination_prefix_list_id":true,"egress_only_gateway_id":true,"gateway_id":true,"id":true,"instance_id":true,"instance_owner_id":true,"nat_gateway_id":true,"network_interface_id":true,"origin":true,"route_table_id":true,"state":true}}},{"address":"module.networking.aws_route.public_internet_route[1]","module_address":"module.networking","mode":"managed","type":"aws_route","name":"public_internet_route","index":1,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"timeouts":null,"transit_gateway_id":null,"vpc_peering_connection_id":null},"after_unknown":{"destination_prefix_list_id":true,"egress_only_gateway_id":true,"gateway_id":true,"id":true,"instance_id":true,"instance_owner_id":true,"nat_gateway_id":true,"network_interface_id":true,"origin":true,"route_table_id":true,"state":true}}},{"address":"module.networking.aws_route.public_internet_route[2]","module_address":"module.networking","mode":"managed","type":"aws_route","name":"public_internet_route","index":2,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"timeouts":null,"transit_gateway_id":null,"vpc_peering_connection_id":null},"after_unknown":{"destination_prefix_list_id":true,"egress_only_gateway_id":true,"gateway_id":true,"id":true,"instance_id":true,"instance_owner_id":true,"nat_gateway_id":true,"network_interface_id":true,"origin":true,"route_table_id":true,"state":true}}},{"address":"module.networking.aws_route.public_internet_route[3]","module_address":"module.networking","mode":"managed","type":"aws_route","name":"public_internet_route","index":3,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"timeouts":null,"transit_gateway_id":null,"vpc_peering_connection_id":null},"after_unknown":{"destination_prefix_list_id":true,"egress_only_gateway_id":true,"gateway_id":true,"id":true,"instance_id":true,"instance_owner_id":true,"nat_gateway_id":true,"network_interface_id":true,"origin":true,"route_table_id":true,"state":true}}},{"address":"module.networking.aws_route_table.private_subnets_route_table[0]","module_address":"module.networking","mode":"managed","type":"aws_route_table","name":"private_subnets_route_table","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"spork-private-rt-us-east-1a"}},"after_unknown":{"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_route_table.private_subnets_route_table[1]","module_address":"module.networking","mode":"managed","type":"aws_route_table","name":"private_subnets_route_table","index":1,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"spork-private-rt-us-east-1b"}},"after_unknown":{"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_route_table.private_subnets_route_table[2]","module_address":"module.networking","mode":"managed","type":"aws_route_table","name":"private_subnets_route_table","index":2,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"spork-private-rt-us-east-1c"}},"after_unknown":{"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_route_table.private_subnets_route_table[3]","module_address":"module.networking","mode":"managed","type":"aws_route_table","name":"private_subnets_route_table","index":3,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"spork-private-rt-us-east-1d"}},"after_unknown":{"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_route_table.public_subnets_route_table[0]","module_address":"module.networking","mode":"managed","type":"aws_route_table","name":"public_subnets_route_table","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"spork-public-rt-us-east-1a"}},"after_unknown":{"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_route_table.public_subnets_route_table[1]","module_address":"module.networking","mode":"managed","type":"aws_route_table","name":"public_subnets_route_table","index":1,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"spork-public-rt-us-east-1b"}},"after_unknown":{"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_route_table.public_subnets_route_table[2]","module_address":"module.networking","mode":"managed","type":"aws_route_table","name":"public_subnets_route_table","index":2,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"spork-public-rt-us-east-1c"}},"after_unknown":{"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_route_table.public_subnets_route_table[3]","module_address":"module.networking","mode":"managed","type":"aws_route_table","name":"public_subnets_route_table","index":3,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"spork-public-rt-us-east-1d"}},"after_unknown":{"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_route_table_association.private_internet_route_table_associations[0]","module_address":"module.networking","mode":"managed","type":"aws_route_table_association","name":"private_internet_route_table_associations","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true}}},{"address":"module.networking.aws_route_table_association.private_internet_route_table_associations[1]","module_address":"module.networking","mode":"managed","type":"aws_route_table_association","name":"private_internet_route_table_associations","index":1,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true}}},{"address":"module.networking.aws_route_table_association.private_internet_route_table_associations[2]","module_address":"module.networking","mode":"managed","type":"aws_route_table_association","name":"private_internet_route_table_associations","index":2,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true}}},{"address":"module.networking.aws_route_table_association.private_internet_route_table_associations[3]","module_address":"module.networking","mode":"managed","type":"aws_route_table_association","name":"private_internet_route_table_associations","index":3,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true}}},{"address":"module.networking.aws_route_table_association.public_internet_route_table_associations[0]","module_address":"module.networking","mode":"managed","type":"aws_route_table_association","name":"public_internet_route_table_associations","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true}}},{"address":"module.networking.aws_route_table_association.public_internet_route_table_associations[1]","module_address":"module.networking","mode":"managed","type":"aws_route_table_association","name":"public_internet_route_table_associations","index":1,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true}}},{"address":"module.networking.aws_route_table_association.public_internet_route_table_associations[2]","module_address":"module.networking","mode":"managed","type":"aws_route_table_association","name":"public_internet_route_table_associations","index":2,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true}}},{"address":"module.networking.aws_route_table_association.public_internet_route_table_associations[3]","module_address":"module.networking","mode":"managed","type":"aws_route_table_association","name":"public_internet_route_table_associations","index":3,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{},"after_unknown":{"id":true,"route_table_id":true,"subnet_id":true}}},{"address":"module.networking.aws_subnet.private_subnets[0]","module_address":"module.networking","mode":"managed","type":"aws_subnet","name":"private_subnets","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1a","cidr_block":"192.168.128.0/19","map_public_ip_on_launch":false,"tags":{"Name":"spork-private-net-us-east-1a"},"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_subnet.private_subnets[1]","module_address":"module.networking","mode":"managed","type":"aws_subnet","name":"private_subnets","index":1,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1b","cidr_block":"192.168.160.0/19","map_public_ip_on_launch":false,"tags":{"Name":"spork-private-net-us-east-1b"},"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_subnet.private_subnets[2]","module_address":"module.networking","mode":"managed","type":"aws_subnet","name":"private_subnets","index":2,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1c","cidr_block":"192.168.192.0/19","map_public_ip_on_launch":false,"tags":{"Name":"spork-private-net-us-east-1c"},"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_subnet.private_subnets[3]","module_address":"module.networking","mode":"managed","type":"aws_subnet","name":"private_subnets","index":3,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1d","cidr_block":"192.168.224.0/19","map_public_ip_on_launch":false,"tags":{"Name":"spork-private-net-us-east-1d"},"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_subnet.public_subnets[0]","module_address":"module.networking","mode":"managed","type":"aws_subnet","name":"public_subnets","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1a","cidr_block":"192.168.0.0/19","map_public_ip_on_launch":true,"tags":{"Name":"spork-public-net-us-east-1a"},"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_subnet.public_subnets[1]","module_address":"module.networking","mode":"managed","type":"aws_subnet","name":"public_subnets","index":1,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1b","cidr_block":"192.168.32.0/19","map_public_ip_on_launch":true,"tags":{"Name":"spork-public-net-us-east-1b"},"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_subnet.public_subnets[2]","module_address":"module.networking","mode":"managed","type":"aws_subnet","name":"public_subnets","index":2,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1c","cidr_block":"192.168.64.0/19","map_public_ip_on_launch":true,"tags":{"Name":"spork-public-net-us-east-1c"},"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_subnet.public_subnets[3]","module_address":"module.networking","mode":"managed","type":"aws_subnet","name":"public_subnets","index":3,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1d","cidr_block":"192.168.96.0/19","map_public_ip_on_launch":true,"tags":{"Name":"spork-public-net-us-east-1d"},"timeouts":null},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"tags":{},"vpc_id":true}}},{"address":"module.networking.aws_vpc.vpc","module_address":"module.networking","mode":"managed","type":"aws_vpc","name":"vpc","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assign_generated_ipv6_cidr_block":false,"cidr_block":"192.168.0.0/16","enable_dns_hostnames":true,"enable_dns_support":true,"instance_tenancy":"default","tags":{"Name":"spork-vpc"}},"after_unknown":{"arn":true,"default_network_acl_id":true,"default_route_table_id":true,"default_security_group_id":true,"dhcp_options_id":true,"enable_classiclink":true,"enable_classiclink_dns_support":true,"id":true,"ipv6_association_id":true,"ipv6_cidr_block":true,"main_route_table_id":true,"owner_id":true,"tags":{}}}},{"address":"module.td.aws_ecs_task_definition.td","module_address":"module.td","mode":"managed","type":"aws_ecs_task_definition","name":"td","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"container_definitions":"[{\"command\":null,\"cpu\":1024,\"dependsOn\":null,\"dnsServers\":null,\"dockerLabels\":null,\"entryPoint\":null,\"environment\":null,\"essential\":true,\"firelensConfiguration\":null,\"healthCheck\":{\"command\":[\"CMD-SHELL\",\"curl -f http://localhost:8080/__healthcheck__ || exit 1\"],\"interval\":30,\"retries\":3,\"startPeriod\":20,\"timeout\":5},\"image\":\"jnonino/symmetrical-spork:latest\",\"links\":null,\"logConfiguration\":{\"logDriver\":\"awslogs\",\"options\":{\"awslogs-group\":\"/ecs/service/spork\",\"awslogs-region\":\"us-east-1\",\"awslogs-stream-prefix\":\"ecs\"},\"secretOptions\":null},\"memory\":8192,\"memoryReservation\":2048,\"mountPoints\":null,\"name\":\"spork\",\"portMappings\":[{\"containerPort\":8080,\"hostPort\":8080,\"protocol\":\"HTTP\"}],\"privileged\":null,\"readonlyRootFilesystem\":false,\"repositoryCredentials\":null,\"secrets\":null,\"startTimeout\":30,\"stopTimeout\":30,\"systemControls\":null,\"ulimits\":null,\"user\":null,\"volumesFrom\":null,\"workingDirectory\":null}]","cpu":"1024","family":"spork-td","ipc_mode":null,"memory":"8192","network_mode":"awsvpc","pid_mode":null,"placement_constraints":[],"proxy_configuration":[],"requires_compatibilities":["FARGATE"],"tags":null,"volume":[]},"after_unknown":{"arn":true,"execution_role_arn":true,"id":true,"placement_constraints":[],"proxy_configuration":[],"requires_compatibilities":[false],"revision":true,"task_role_arn":true,"volume":[]}}},{"address":"module.td.aws_iam_role.ecs_task_execution_role","module_address":"module.td","mode":"managed","type":"aws_iam_role","name":"ecs_task_execution_role","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"Service\": \"ecs-tasks.amazonaws.com\"\n            },\n            \"Action\": \"sts:AssumeRole\",\n            \"Sid\": \"\"\n        }\n    ]\n}\n","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"spork-ecs-task-execution-role","name_prefix":null,"path":"/","permissions_boundary":null,"tags":null},"after_unknown":{"arn":true,"create_date":true,"id":true,"unique_id":true}}},{"address":"module.td.aws_iam_role_policy_attachment.ecs_task_execution_role_policy_attach","module_address":"module.td","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ecs_task_execution_role_policy_attach","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"policy_arn":"arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy","role":"spork-ecs-task-execution-role"},"after_unknown":{"id":true}}}],"output_changes":{"aws_ecs_service_service_cluster":{"actions":["create"],"before":null,"after_unknown":true},"aws_ecs_service_service_desired_count":{"actions":["create"],"before":null,"after":1,"after_unknown":false},"aws_ecs_service_service_id":{"actions":["create"],"before":null,"after_unknown":true},"aws_ecs_service_service_name":{"actions":["create"],"before":null,"after":"spork-service","after_unknown":false},"ecs_tasks_sg_arn":{"actions":["create"],"before":null,"after_unknown":true},"ecs_tasks_sg_description":{"actions":["create"],"before":null,"after":"Allow inbound access from the LB only","after_unknown":false},"ecs_tasks_sg_id":{"actions":["create"],"before":null,"after_unknown":true},"ecs_tasks_sg_name":{"actions":["create"],"before":null,"after":"spork-ecs-tasks-sg","after_unknown":false},"lb_arn":{"actions":["create"],"before":null,"after_unknown":true},"lb_arn_suffix":{"actions":["create"],"before":null,"after_unknown":true},"lb_dns_name":{"actions":["create"],"before":null,"after_unknown":true},"lb_id":{"actions":["create"],"before":null,"after_unknown":true},"lb_sg_arn":{"actions":["create"],"before":null,"after_unknown":true},"lb_sg_description":{"actions":["create"],"before":null,"after":"Control access to LB","after_unknown":false},"lb_sg_id":{"actions":["create"],"before":null,"after_unknown":true},"lb_sg_name":{"actions":["create"],"before":null,"after":"spork-lb-sg","after_unknown":false},"lb_zone_id":{"actions":["create"],"before":null,"after_unknown":true}},"configuration":{"provider_config":{"aws_cw_logs:aws":{"name":"aws","module_address":"aws_cw_logs","expressions":{"profile":{"references":["var.profile"]},"region":{"references":["var.region"]}}},"ecs-cluster:aws":{"name":"aws","module_address":"ecs-cluster","expressions":{"profile":{"references":["var.profile"]},"region":{"references":["var.region"]}}},"ecs-fargate-service:aws":{"name":"aws","module_address":"ecs-fargate-service","expressions":{"profile":{"references":["var.profile"]},"region":{"references":["var.region"]}}},"networking:aws":{"name":"aws","module_address":"networking","expressions":{"profile":{"references":["var.profile"]},"region":{"references":["var.region"]}}},"td:aws":{"name":"aws","module_address":"td","expressions":{"profile":{"references":["var.profile"]},"region":{"references":["var.region"]}}}},"root_module":{"outputs":{"aws_ecs_service_service_cluster":{"expression":{"references":["module.ecs-fargate-service.aws_ecs_service_service_cluster"]},"description":"The Amazon Resource Name (ARN) of cluster which the service runs on."},"aws_ecs_service_service_desired_count":{"expression":{"references":["module.ecs-fargate-service.aws_ecs_service_service_desired_count"]},"description":"The number of instances of the task definition"},"aws_ecs_service_service_id":{"expression":{"references":["module.ecs-fargate-service.aws_ecs_service_service_id"]},"description":"The Amazon Resource Name (ARN) that identifies the service."},"aws_ecs_service_service_name":{"expression":{"references":["module.ecs-fargate-service.aws_ecs_service_service_name"]},"description":"The name of the service."},"ecs_tasks_sg_arn":{"expression":{"references":["module.ecs-fargate-service.ecs_tasks_sg_arn"]},"description":"ECS Tasks Security Group - The ARN of the security group"},"ecs_tasks_sg_description":{"expression":{"references":["module.ecs-fargate-service.ecs_tasks_sg_description"]},"description":"ECS Tasks Security Group - The description of the security group"},"ecs_tasks_sg_id":{"expression":{"references":["module.ecs-fargate-service.ecs_tasks_sg_id"]},"description":"ECS Tasks Security Group - The ID of the security group"},"ecs_tasks_sg_name":{"expression":{"references":["module.ecs-fargate-service.ecs_tasks_sg_name"]},"description":"ECS Tasks Security Group - The name of the security group"},"lb_arn":{"expression":{"references":["module.ecs-fargate-service.lb_arn"]},"description":"Load Balancer ARN"},"lb_arn_suffix":{"expression":{"references":["module.ecs-fargate-service.lb_arn_suffix"]},"description":"Load Balancer ARN Suffix"},"lb_dns_name":{"expression":{"references":["module.ecs-fargate-service.lb_dns_name"]},"description":"Load Balancer DNS Name"},"lb_id":{"expression":{"references":["module.ecs-fargate-service.lb_id"]},"description":"Load Balancer ID"},"lb_sg_arn":{"expression":{"references":["module.ecs-fargate-service.lb_sg_arn"]},"description":"Load Balancer Security Group - The ARN of the security group"},"lb_sg_description":{"expression":{"references":["module.ecs-fargate-service.lb_sg_description"]},"description":"Load Balancer Security Group - The description of the security group"},"lb_sg_id":{"expression":{"references":["module.ecs-fargate-service.lb_sg_id"]},"description":"Load Balancer Security Group - The ID of the security group"},"lb_sg_name":{"expression":{"references":["module.ecs-fargate-service.lb_sg_name"]},"description":"Load Balancer Security Group - The name of the security group"},"lb_zone_id":{"expression":{"references":["module.ecs-fargate-service.lb_zone_id"]},"description":"Load Balancer Zone ID"}},"module_calls":{"aws_cw_logs":{"source":"cn-terraform/cloudwatch-logs/aws","expressions":{"logs_path":{"references":["var.log_group_path"]},"profile":{"references":["var.profile"]},"region":{"references":["var.region"]}},"module":{"outputs":{"log_group_arn":{"expression":{"references":["aws_cloudwatch_log_group.log_group"]},"description":"The Amazon Resource Name (ARN) specifying the log group."},"log_stream_arn":{"expression":{"references":["aws_cloudwatch_log_stream.log_stream"]},"description":"The Amazon Resource Name (ARN) specifying the log stream."},"logs_path":{"expression":{"references":["var.logs_path"]},"description":"Path of the logs in CloudWatch"}},"resources":[{"address":"aws_cloudwatch_log_group.log_group","mode":"managed","type":"aws_cloudwatch_log_group","name":"log_group","provider_config_key":"aws_cw_logs:aws","expressions":{"kms_key_id":{"references":["var.log_group_kms_key_id"]},"name":{"references":["var.logs_path"]},"retention_in_days":{"references":["var.log_group_retention_in_days"]}},"schema_version":0},{"address":"aws_cloudwatch_log_stream.log_stream","mode":"managed","type":"aws_cloudwatch_log_stream","name":"log_stream","provider_config_key":"aws_cw_logs:aws","expressions":{"log_group_name":{"references":["aws_cloudwatch_log_group.log_group"]},"name":{"references":["var.logs_path"]}},"schema_version":0}],"variables":{"log_group_kms_key_id":{"default":"","description":"The ARN of the KMS Key to use when encrypting log data. Please note, after the AWS KMS CMK is disassociated from the log group, AWS CloudWatch Logs stops encrypting newly ingested data for the log group. All previously ingested data remains encrypted, and AWS CloudWatch Logs requires permissions for the CMK whenever the encrypted data is requested."},"log_group_retention_in_days":{"default":30,"description":"(Optional) Specifies the number of days you want to retain log events in the specified log group. Default to 30 days"},"logs_path":{"description":"Path of the logs in CloudWatch"},"profile":{"description":"AWS API key credentials to use"},"region":{"description":"AWS Region the infrastructure is hosted in"}}},"version_constraint":"1.0.3"},"ecs-cluster":{"source":"cn-terraform/ecs-cluster/aws","expressions":{"name":{"references":["var.name_preffix"]},"profile":{"references":["var.profile"]},"region":{"references":["var.region"]}},"module":{"outputs":{"aws_ecs_cluster_cluster_arn":{"expression":{"references":["aws_ecs_cluster.cluster"]},"description":"The Amazon Resource Name (ARN) that identifies the cluster"},"aws_ecs_cluster_cluster_id":{"expression":{"references":["aws_ecs_cluster.cluster"]},"description":"The Amazon ID that identifies the cluster"},"aws_ecs_cluster_cluster_name":{"expression":{"references":["aws_ecs_cluster.cluster"]},"description":"The name of the cluster"}},"resources":[{"address":"aws_ecs_cluster.cluster","mode":"managed","type":"aws_ecs_cluster","name":"cluster","provider_config_key":"ecs-cluster:aws","expressions":{"name":{"references":["var.name"]}},"schema_version":0}],"variables":{"name":{"description":"The name of the cluster (up to 255 letters, numbers, hyphens, and underscores)"},"profile":{"description":"AWS API key credentials to use"},"region":{"description":"AWS Region where the infrastructure is hosted in"}}},"version_constraint":"1.0.2"},"ecs-fargate-service":{"source":"cn-terraform/ecs-fargate-service/aws","expressions":{"container_name":{"references":["local.container_name"]},"container_port":{"references":["module.td.container_port"]},"ecs_cluster_arn":{"references":["module.ecs-cluster.aws_ecs_cluster_cluster_arn"]},"ecs_cluster_name":{"references":["module.ecs-cluster.aws_ecs_cluster_cluster_name"]},"health_check_grace_period_seconds":{"constant_value":20},"name_preffix":{"references":["var.name_preffix"]},"private_subnets":{"references":["module.networking.private_subnets_ids"]},"profile":{"references":["var.profile"]},"public_subnets":{"references":["module.networking.public_subnets_ids"]},"region":{"references":["var.region"]},"task_definition_arn":{"references":["module.td.aws_ecs_task_definition_td_arn"]},"vpc_id":{"references":["module.networking.vpc_id"]}},"module":{"outputs":{"aws_ecs_service_service_cluster":{"expression":{"references":["aws_ecs_service.service"]},"description":"The Amazon Resource Name (ARN) of cluster which the service runs on."},"aws_ecs_service_service_desired_count":{"expression":{"references":["aws_ecs_service.service"]},"description":"The number of instances of the task definition"},"aws_ecs_service_service_id":{"expression":{"references":["aws_ecs_service.service"]},"description":"The Amazon Resource Name (ARN) that identifies the service."},"aws_ecs_service_service_name":{"expression":{"references":["aws_ecs_service.service"]},"description":"The name of the service."},"ecs_tasks_sg_arn":{"expression":{"references":["aws_security_group.ecs_tasks_sg"]},"description":"${var.name_preffix} ECS Tasks Security Group - The ARN of the security group"},"ecs_tasks_sg_description":{"expression":{"references":["aws_security_group.ecs_tasks_sg"]},"description":"${var.name_preffix} ECS Tasks Security Group - The description of the security group"},"ecs_tasks_sg_id":{"expression":{"references":["aws_security_group.ecs_tasks_sg"]},"description":"${var.name_preffix} ECS Tasks Security Group - The ID of the security group"},"ecs_tasks_sg_name":{"expression":{"references":["aws_security_group.ecs_tasks_sg"]},"description":"${var.name_preffix} ECS Tasks Security Group - The name of the security group"},"lb_arn":{"expression":{"references":["aws_lb.lb"]},"description":"${var.name_preffix} Load Balancer ARN"},"lb_arn_suffix":{"expression":{"references":["aws_lb.lb"]},"description":"${var.name_preffix} Load Balancer ARN Suffix"},"lb_dns_name":{"expression":{"references":["aws_lb.lb"]},"description":"${var.name_preffix} Load Balancer DNS Name"},"lb_id":{"expression":{"references":["aws_lb.lb"]},"description":"${var.name_preffix} Load Balancer ID"},"lb_sg_arn":{"expression":{"references":["aws_security_group.lb_sg"]},"description":"${var.name_preffix} Load Balancer Security Group - The ARN of the security group"},"lb_sg_description":{"expression":{"references":["aws_security_group.lb_sg"]},"description":"${var.name_preffix} Load Balancer Security Group - The description of the security group"},"lb_sg_id":{"expression":{"references":["aws_security_group.lb_sg"]},"description":"${var.name_preffix} Load Balancer Security Group - The ID of the security group"},"lb_sg_name":{"expression":{"references":["aws_security_group.lb_sg"]},"description":"${var.name_preffix} Load Balancer Security Group - The name of the security group"},"lb_zone_id":{"expression":{"references":["aws_lb.lb"]},"description":"${var.name_preffix} Load Balancer Zone ID"}},"resources":[{"address":"aws_appautoscaling_policy.scale_down_policy","mode":"managed","type":"aws_appautoscaling_policy","name":"scale_down_policy","provider_config_key":"ecs-fargate-service:aws","expressions":{"name":{"references":["var.name_preffix"]},"resource_id":{"references":["var.ecs_cluster_name","aws_ecs_service.service"]},"scalable_dimension":{"constant_value":"ecs:service:DesiredCount"},"service_namespace":{"constant_value":"ecs"},"step_scaling_policy_configuration":[{"adjustment_type":{"constant_value":"ChangeInCapacity"},"cooldown":{"constant_value":60},"metric_aggregation_type":{"constant_value":"Maximum"},"step_adjustment":[{"metric_interval_lower_bound":{"constant_value":0},"scaling_adjustment":{"constant_value":-1}}]}]},"schema_version":0,"depends_on":["aws_appautoscaling_target.scale_target"]},{"address":"aws_appautoscaling_policy.scale_up_policy","mode":"managed","type":"aws_appautoscaling_policy","name":"scale_up_policy","provider_config_key":"ecs-fargate-service:aws","expressions":{"name":{"references":["var.name_preffix"]},"resource_id":{"references":["var.ecs_cluster_name","aws_ecs_service.service"]},"scalable_dimension":{"constant_value":"ecs:service:DesiredCount"},"service_namespace":{"constant_value":"ecs"},"step_scaling_policy_configuration":[{"adjustment_type":{"constant_value":"ChangeInCapacity"},"cooldown":{"constant_value":60},"metric_aggregation_type":{"constant_value":"Maximum"},"step_adjustment":[{"metric_interval_lower_bound":{"constant_value":0},"scaling_adjustment":{"constant_value":1}}]}]},"schema_version":0,"depends_on":["aws_appautoscaling_target.scale_target"]},{"address":"aws_appautoscaling_target.scale_target","mode":"managed","type":"aws_appautoscaling_target","name":"scale_target","provider_config_key":"ecs-fargate-service:aws","expressions":{"max_capacity":{"constant_value":5},"min_capacity":{"constant_value":1},"resource_id":{"references":["var.ecs_cluster_name","aws_ecs_service.service"]},"role_arn":{"references":["aws_iam_role.ecs_autoscale_role"]},"scalable_dimension":{"constant_value":"ecs:service:DesiredCount"},"service_namespace":{"constant_value":"ecs"}},"schema_version":0},{"address":"aws_cloudwatch_metric_alarm.cpu_high","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"cpu_high","provider_config_key":"ecs-fargate-service:aws","expressions":{"alarm_actions":{"references":["aws_appautoscaling_policy.scale_up_policy"]},"alarm_name":{"references":["var.name_preffix"]},"comparison_operator":{"constant_value":"GreaterThanOrEqualToThreshold"},"dimensions":{"references":["var.ecs_cluster_name","aws_ecs_service.service"]},"evaluation_periods":{"constant_value":"3"},"metric_name":{"constant_value":"CPUUtilization"},"namespace":{"constant_value":"AWS/ECS"},"period":{"constant_value":"60"},"statistic":{"constant_value":"Maximum"},"threshold":{"constant_value":"85"}},"schema_version":1},{"address":"aws_cloudwatch_metric_alarm.cpu_low","mode":"managed","type":"aws_cloudwatch_metric_alarm","name":"cpu_low","provider_config_key":"ecs-fargate-service:aws","expressions":{"alarm_actions":{"references":["aws_appautoscaling_policy.scale_down_policy"]},"alarm_name":{"references":["var.name_preffix"]},"comparison_operator":{"constant_value":"LessThanOrEqualToThreshold"},"dimensions":{"references":["var.ecs_cluster_name","aws_ecs_service.service"]},"evaluation_periods":{"constant_value":"3"},"metric_name":{"constant_value":"CPUUtilization"},"namespace":{"constant_value":"AWS/ECS"},"period":{"constant_value":"60"},"statistic":{"constant_value":"Average"},"threshold":{"constant_value":"10"}},"schema_version":1},{"address":"aws_ecs_service.service","mode":"managed","type":"aws_ecs_service","name":"service","provider_config_key":"ecs-fargate-service:aws","expressions":{"cluster":{"references":["var.ecs_cluster_arn"]},"deployment_maximum_percent":{"references":["var.deployment_maximum_percent"]},"deployment_minimum_healthy_percent":{"references":["var.deployment_minimum_healthy_percent"]},"desired_count":{"references":["var.desired_count"]},"enable_ecs_managed_tags":{"references":["var.enable_ecs_managed_tags"]},"health_check_grace_period_seconds":{"references":["var.health_check_grace_period_seconds"]},"launch_type":{"constant_value":"FARGATE"},"load_balancer":[{"container_name":{"references":["var.container_name"]},"container_port":{"references":["var.container_port"]},"target_group_arn":{"references":["aws_lb_target_group.lb_tg"]}}],"name":{"references":["var.name_preffix"]},"network_configuration":[{"assign_public_ip":{"references":["var.assign_public_ip"]},"security_groups":{"references":["aws_security_group.ecs_tasks_sg"]},"subnets":{"references":["var.private_subnets"]}}],"platform_version":{"references":["var.platform_version"]},"propagate_tags":{"references":["var.propagate_tags"]},"task_definition":{"references":["var.task_definition_arn"]}},"schema_version":0,"depends_on":["aws_lb_listener.listener"]},{"address":"aws_iam_role.ecs_autoscale_role","mode":"managed","type":"aws_iam_role","name":"ecs_autoscale_role","provider_config_key":"ecs-fargate-service:aws","expressions":{"assume_role_policy":{"references":["path.module"]},"name":{"references":["var.name_preffix"]}},"schema_version":0},{"address":"aws_iam_role_policy.ecs_autoscale_role_policy","mode":"managed","type":"aws_iam_role_policy","name":"ecs_autoscale_role_policy","provider_config_key":"ecs-fargate-service:aws","expressions":{"name":{"references":["var.name_preffix"]},"policy":{"references":["path.module"]},"role":{"references":["aws_iam_role.ecs_autoscale_role"]}},"schema_version":0},{"address":"aws_kms_key.encryption_key","mode":"managed","type":"aws_kms_key","name":"encryption_key","provider_config_key":"ecs-fargate-service:aws","expressions":{"description":{"references":["var.name_preffix"]},"enable_key_rotation":{"constant_value":true},"is_enabled":{"constant_value":true}},"schema_version":0},{"address":"aws_lb.lb","mode":"managed","type":"aws_lb","name":"lb","provider_config_key":"ecs-fargate-service:aws","expressions":{"enable_cross_zone_load_balancing":{"constant_value":true},"enable_deletion_protection":{"constant_value":false},"internal":{"constant_value":false},"load_balancer_type":{"constant_value":"application"},"name":{"references":["var.name_preffix"]},"security_groups":{"references":["aws_security_group.lb_sg"]},"subnets":{"references":["var.public_subnets"]},"tags":{"references":["var.name_preffix"]}},"schema_version":0},{"address":"aws_lb_listener.listener","mode":"managed","type":"aws_lb_listener","name":"listener","provider_config_key":"ecs-fargate-service:aws","expressions":{"default_action":[{"target_group_arn":{"references":["aws_lb_target_group.lb_tg"]},"type":{"constant_value":"forward"}}],"load_balancer_arn":{"references":["aws_lb.lb"]},"port":{"constant_value":"80"},"protocol":{"constant_value":"HTTP"}},"schema_version":0,"depends_on":["aws_lb_target_group.lb_tg"]},{"address":"aws_lb_target_group.lb_tg","mode":"managed","type":"aws_lb_target_group","name":"lb_tg","provider_config_key":"ecs-fargate-service:aws","expressions":{"health_check":[{"path":{"constant_value":"/"},"port":{"references":["var.container_port"]}}],"name":{"references":["var.name_preffix"]},"port":{"references":["var.container_port"]},"protocol":{"constant_value":"HTTP"},"tags":{"references":["var.name_preffix"]},"target_type":{"constant_value":"ip"},"vpc_id":{"references":["var.vpc_id"]}},"schema_version":0,"depends_on":["aws_lb.lb"]},{"address":"aws_security_group.ecs_tasks_sg","mode":"managed","type":"aws_security_group","name":"ecs_tasks_sg","provider_config_key":"ecs-fargate-service:aws","expressions":{"description":{"constant_value":"Allow inbound access from the LB only"},"name":{"references":["var.name_preffix"]},"tags":{"references":["var.name_preffix"]},"vpc_id":{"references":["var.vpc_id"]}},"schema_version":1},{"address":"aws_security_group.lb_sg","mode":"managed","type":"aws_security_group","name":"lb_sg","provider_config_key":"ecs-fargate-service:aws","expressions":{"description":{"constant_value":"Control access to LB"},"name":{"references":["var.name_preffix"]},"tags":{"references":["var.name_preffix"]},"vpc_id":{"references":["var.vpc_id"]}},"schema_version":1}],"variables":{"assign_public_ip":{"default":false,"description":"(Optional) Assign a public IP address to the ENI (Fargate launch type only). Valid values are true or false. Default false."},"container_name":{"description":"Name of the running container"},"container_port":{"description":"Port on which the container is listening"},"deployment_maximum_percent":{"default":200,"description":"(Optional) The upper limit (as a percentage of the service's desiredCount) of the number of running tasks that can be running in a service during a deployment."},"deployment_minimum_healthy_percent":{"default":100,"description":"(Optional) The lower limit (as a percentage of the service's desiredCount) of the number of running tasks that must remain running and healthy in a service during a deployment."},"desired_count":{"default":1,"description":"(Optional) The number of instances of the task definition to place and keep running. Defaults to 1."},"ecs_cluster_arn":{"description":"ARN of an ECS cluster"},"ecs_cluster_name":{"description":"Name of the ECS cluster"},"enable_ecs_managed_tags":{"default":false,"description":"(Optional) Specifies whether to enable Amazon ECS managed tags for the tasks within the service.Valid values are true or false. Default true."},"health_check_grace_period_seconds":{"default":0,"description":"(Optional) Seconds to ignore failing load balancer health checks on newly instantiated tasks to prevent premature shutdown, up to 2147483647. Only valid for services configured to use load balancers."},"name_preffix":{"description":"Name preffix for resources on AWS"},"ordered_placement_strategy":{"default":[],"description":"(Optional) Service level strategy rules that are taken into consideration during task placement. List from top to bottom in order of precedence. The maximum number of ordered_placement_strategy blocks is 5. This is a list of maps where each map should contain \"id\" and \"field\""},"placement_constraints":{"default":[],"description":"(Optional) rules that are taken into consideration during task placement. Maximum number of placement_constraints is 10. This is a list of maps, where each map should contain \"type\" and \"expression\""},"platform_version":{"default":"LATEST","description":"(Optional) The platform version on which to run your service. Defaults to LATEST. More information about Fargate platform versions can be found in the AWS ECS User Guide."},"private_subnets":{"description":"The private subnets associated with the task or service."},"profile":{"description":"AWS API key credentials to use"},"propagate_tags":{"default":"SERVICE","description":"(Optional) Specifies whether to propagate the tags from the task definition or the service to the tasks. The valid values are SERVICE and TASK_DEFINITION. Default to SERVICE"},"public_subnets":{"description":"The public subnets associated with the task or service."},"region":{"description":"AWS Region the infrastructure is hosted in"},"security_groups":{"default":[],"description":"(Optional) The security groups associated with the task or service. If you do not specify a security group, the default security group for the VPC is used."},"service_registries":{"default":{},"description":"(Optional) The service discovery registries for the service. The maximum number of service_registries blocks is 1. This is a map that should contain the following fields \"registry_arn\", \"port\", \"container_port\" and \"container_name\""},"task_definition_arn":{"description":"(Required) The full ARN of the task definition that you want to run in your service."},"vpc_id":{"description":"ID of the VPC"}}},"version_constraint":"1.0.6"},"networking":{"source":"cn-terraform/networking/aws","expressions":{"availability_zones":{"constant_value":["us-east-1a","us-east-1b","us-east-1c","us-east-1d"]},"name_preffix":{"references":["var.name_preffix"]},"private_subnets_cidrs_per_availability_zone":{"constant_value":["192.168.128.0/19","192.168.160.0/19","192.168.192.0/19","192.168.224.0/19"]},"profile":{"references":["var.profile"]},"public_subnets_cidrs_per_availability_zone":{"constant_value":["192.168.0.0/19","192.168.32.0/19","192.168.64.0/19","192.168.96.0/19"]},"region":{"references":["var.region"]},"vpc_cidr_block":{"constant_value":"192.168.0.0/16"}},"module":{"outputs":{"availability_zones":{"expression":{"references":["var.availability_zones"]},"description":"List of availability zones used by subnets"},"internet_gateway_id":{"expression":{"references":["aws_internet_gateway.internet_gw"]},"description":"ID of the generated Internet Gateway"},"nat_gw_ids":{"expression":{"references":["aws_nat_gateway.nat_gw"]},"description":"List with the IDs of the NAT Gateways created on public subnets to provide internet to private subnets"},"private_subnets_ids":{"expression":{"references":["aws_subnet.private_subnets"]},"description":"List with the Private Subnets IDs"},"private_subnets_route_table_id":{"expression":{"references":["aws_route_table.private_subnets_route_table"]},"description":"ID of the Route Table used on Private networks"},"public_subnets_ids":{"expression":{"references":["aws_subnet.public_subnets"]},"description":"List with the Public Subnets IDs"},"public_subnets_route_table_id":{"expression":{"references":["aws_route_table.public_subnets_route_table"]},"description":"ID of the Route Tables used on Public networks"},"vpc_cidr_block":{"expression":{"references":["aws_vpc.vpc"]},"description":"The CIDR block of the VPC"},"vpc_id":{"expression":{"references":["aws_vpc.vpc"]},"description":"The ID of the VPC"}},"resources":[{"address":"aws_eip.nat_eip","mode":"managed","type":"aws_eip","name":"nat_eip","provider_config_key":"networking:aws","expressions":{"tags":{"references":["var.name_preffix","var.availability_zones","count.index"]},"vpc":{"constant_value":true}},"schema_version":0,"count_expression":{"references":["var.availability_zones"]}},{"address":"aws_internet_gateway.internet_gw","mode":"managed","type":"aws_internet_gateway","name":"internet_gw","provider_config_key":"networking:aws","expressions":{"tags":{"references":["var.name_preffix"]},"vpc_id":{"references":["aws_vpc.vpc"]}},"schema_version":0},{"address":"aws_nat_gateway.nat_gw","mode":"managed","type":"aws_nat_gateway","name":"nat_gw","provider_config_key":"networking:aws","expressions":{"allocation_id":{"references":["aws_eip.nat_eip","count.index"]},"subnet_id":{"references":["aws_subnet.public_subnets","count.index"]},"tags":{"references":["var.name_preffix","var.availability_zones","count.index"]}},"schema_version":0,"count_expression":{"references":["var.availability_zones"]},"depends_on":["aws_internet_gateway.internet_gw"]},{"address":"aws_route.private_internet_route","mode":"managed","type":"aws_route","name":"private_internet_route","provider_config_key":"networking:aws","expressions":{"destination_cidr_block":{"constant_value":"0.0.0.0/0"},"nat_gateway_id":{"references":["aws_nat_gateway.nat_gw","count.index"]},"route_table_id":{"references":["aws_route_table.private_subnets_route_table","count.index"]}},"schema_version":0,"count_expression":{"references":["var.availability_zones"]},"depends_on":["aws_internet_gateway.internet_gw","aws_route_table.private_subnets_route_table"]},{"address":"aws_route.public_internet_route","mode":"managed","type":"aws_route","name":"public_internet_route","provider_config_key":"networking:aws","expressions":{"destination_cidr_block":{"constant_value":"0.0.0.0/0"},"gateway_id":{"references":["aws_internet_gateway.internet_gw"]},"route_table_id":{"references":["aws_route_table.public_subnets_route_table","count.index"]}},"schema_version":0,"count_expression":{"references":["var.availability_zones"]},"depends_on":["aws_internet_gateway.internet_gw","aws_route_table.public_subnets_route_table"]},{"address":"aws_route_table.private_subnets_route_table","mode":"managed","type":"aws_route_table","name":"private_subnets_route_table","provider_config_key":"networking:aws","expressions":{"tags":{"references":["var.name_preffix","var.availability_zones","count.index"]},"vpc_id":{"references":["aws_vpc.vpc"]}},"schema_version":0,"count_expression":{"references":["var.availability_zones"]}},{"address":"aws_route_table.public_subnets_route_table","mode":"managed","type":"aws_route_table","name":"public_subnets_route_table","provider_config_key":"networking:aws","expressions":{"tags":{"references":["var.name_preffix","var.availability_zones","count.index"]},"vpc_id":{"references":["aws_vpc.vpc"]}},"schema_version":0,"count_expression":{"references":["var.availability_zones"]}},{"address":"aws_route_table_association.private_internet_route_table_associations","mode":"managed","type":"aws_route_table_association","name":"private_internet_route_table_associations","provider_config_key":"networking:aws","expressions":{"route_table_id":{"references":["aws_route_table.private_subnets_route_table","count.index"]},"subnet_id":{"references":["aws_subnet.private_subnets","count.index"]}},"schema_version":0,"count_expression":{"references":["var.private_subnets_cidrs_per_availability_zone"]}},{"address":"aws_route_table_association.public_internet_route_table_associations","mode":"managed","type":"aws_route_table_association","name":"public_internet_route_table_associations","provider_config_key":"networking:aws","expressions":{"route_table_id":{"references":["aws_route_table.public_subnets_route_table","count.index"]},"subnet_id":{"references":["aws_subnet.public_subnets","count.index"]}},"schema_version":0,"count_expression":{"references":["var.public_subnets_cidrs_per_availability_zone"]}},{"address":"aws_subnet.private_subnets","mode":"managed","type":"aws_subnet","name":"private_subnets","provider_config_key":"networking:aws","expressions":{"availability_zone":{"references":["var.availability_zones","count.index"]},"cidr_block":{"references":["var.private_subnets_cidrs_per_availability_zone","count.index"]},"map_public_ip_on_launch":{"constant_value":false},"tags":{"references":["var.name_preffix","var.availability_zones","count.index"]},"vpc_id":{"references":["aws_vpc.vpc"]}},"schema_version":1,"count_expression":{"references":["var.availability_zones"]}},{"address":"aws_subnet.public_subnets","mode":"managed","type":"aws_subnet","name":"public_subnets","provider_config_key":"networking:aws","expressions":{"availability_zone":{"references":["var.availability_zones","count.index"]},"cidr_block":{"references":["var.public_subnets_cidrs_per_availability_zone","count.index"]},"map_public_ip_on_launch":{"constant_value":true},"tags":{"references":["var.name_preffix","var.availability_zones","count.index"]},"vpc_id":{"references":["aws_vpc.vpc"]}},"schema_version":1,"count_expression":{"references":["var.availability_zones"]}},{"address":"aws_vpc.vpc","mode":"managed","type":"aws_vpc","name":"vpc","provider_config_key":"networking:aws","expressions":{"cidr_block":{"references":["var.vpc_cidr_block"]},"enable_dns_hostnames":{"constant_value":true},"enable_dns_support":{"constant_value":true},"tags":{"references":["var.name_preffix"]}},"schema_version":1}],"variables":{"availability_zones":{"description":"List of availability zones to be used by subnets"},"name_preffix":{"description":"Name preffix for resources on AWS"},"private_subnets_cidrs_per_availability_zone":{"description":"List of CIDRs to use on each availability zone for private subnets"},"profile":{"description":"AWS API key credentials to use"},"public_subnets_cidrs_per_availability_zone":{"description":"List of CIDRs to use on each availability zone for public subnets"},"region":{"description":"AWS Region the infrastructure is hosted in"},"vpc_cidr_block":{"description":"AWS VPC CIDR Block"}}},"version_constraint":"2.0.3"},"td":{"source":"cn-terraform/ecs-fargate-task-definition/aws","expressions":{"container_image":{"references":["var.container_image"]},"container_name":{"references":["local.container_name"]},"container_port":{"references":["var.container_port"]},"healthcheck":{"references":["local.healthcheck"]},"log_configuration":{"references":["local.log_configuration"]},"name_preffix":{"references":["var.name_preffix"]},"profile":{"references":["var.profile"]},"region":{"references":["var.region"]}},"module":{"outputs":{"aws_ecs_task_definition_td_arn":{"expression":{"references":["aws_ecs_task_definition.td"]},"description":"Full ARN of the Task Definition (including both family and revision)."},"aws_ecs_task_definition_td_family":{"expression":{"references":["aws_ecs_task_definition.td"]},"description":"The family of the Task Definition."},"aws_ecs_task_definition_td_revision":{"expression":{"references":["aws_ecs_task_definition.td"]},"description":"The revision of the task in a particular family."},"aws_iam_role_ecs_task_execution_role_arn":{"expression":{"references":["aws_iam_role.ecs_task_execution_role"]},"description":"The Amazon Resource Name (ARN) specifying the role."},"aws_iam_role_ecs_task_execution_role_create_date":{"expression":{"references":["aws_iam_role.ecs_task_execution_role"]},"description":"The creation date of the IAM role."},"aws_iam_role_ecs_task_execution_role_description":{"expression":{"references":["aws_iam_role.ecs_task_execution_role"]},"description":"The description of the role."},"aws_iam_role_ecs_task_execution_role_id":{"expression":{"references":["aws_iam_role.ecs_task_execution_role"]},"description":"The ID of the role."},"aws_iam_role_ecs_task_execution_role_name":{"expression":{"references":["aws_iam_role.ecs_task_execution_role"]},"description":"The name of the role."},"aws_iam_role_ecs_task_execution_role_unique_id":{"expression":{"references":["aws_iam_role.ecs_task_execution_role"]},"description":"The stable and unique string identifying the role."},"container_port":{"expression":{"references":["var.container_port"]},"description":"Port on which the container is listening"}},"resources":[{"address":"aws_ecs_task_definition.td","mode":"managed","type":"aws_ecs_task_definition","name":"td","provider_config_key":"td:aws","expressions":{"container_definitions":{"references":["module.container_definition.json_map"]},"cpu":{"references":["var.container_cpu"]},"execution_role_arn":{"references":["aws_iam_role.ecs_task_execution_role"]},"family":{"references":["var.name_preffix"]},"memory":{"references":["var.container_memory"]},"network_mode":{"constant_value":"awsvpc"},"requires_compatibilities":{"constant_value":["FARGATE"]},"task_role_arn":{"references":["aws_iam_role.ecs_task_execution_role"]}},"schema_version":1},{"address":"aws_iam_role.ecs_task_execution_role","mode":"managed","type":"aws_iam_role","name":"ecs_task_execution_role","provider_config_key":"td:aws","expressions":{"assume_role_policy":{"references":["path.module"]},"name":{"references":["var.name_preffix"]}},"schema_version":0},{"address":"aws_iam_role_policy_attachment.ecs_task_execution_role_policy_attach","mode":"managed","type":"aws_iam_role_policy_attachment","name":"ecs_task_execution_role_policy_attach","provider_config_key":"td:aws","expressions":{"policy_arn":{"constant_value":"arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy"},"role":{"references":["aws_iam_role.ecs_task_execution_role"]}},"schema_version":0}],"module_calls":{"container_definition":{"source":"cloudposse/ecs-container-definition/aws","expressions":{"command":{"references":["var.command"]},"container_cpu":{"references":["var.container_cpu"]},"container_depends_on":{"references":["var.container_depends_on"]},"container_image":{"references":["var.container_image"]},"container_memory":{"references":["var.container_memory"]},"container_memory_reservation":{"references":["var.container_memory_reservation"]},"container_name":{"references":["var.container_name"]},"dns_servers":{"references":["var.dns_servers"]},"docker_labels":{"references":["var.docker_labels"]},"entrypoint":{"references":["var.entrypoint"]},"environment":{"references":["var.environment"]},"essential":{"references":["var.essential"]},"firelens_configuration":{"references":["var.firelens_configuration"]},"healthcheck":{"references":["var.healthcheck"]},"links":{"references":["var.links"]},"log_configuration":{"references":["var.log_configuration"]},"mount_points":{"references":["var.mount_points"]},"port_mappings":{"references":["local.port_mappings"]},"readonly_root_filesystem":{"references":["var.readonly_root_filesystem"]},"repository_credentials":{"references":["var.repository_credentials"]},"secrets":{"references":["var.secrets"]},"start_timeout":{"references":["var.start_timeout"]},"stop_timeout":{"references":["var.stop_timeout"]},"system_controls":{"references":["var.system_controls"]},"ulimits":{"references":["var.ulimits"]},"user":{"references":["var.user"]},"volumes_from":{"references":["var.volumes_from"]},"working_directory":{"references":["var.working_directory"]}},"module":{"outputs":{"json":{"expression":{"references":["local.json_map"]},"description":"JSON encoded list of container definitions for use with other terraform resources such as aws_ecs_task_definition"},"json_map":{"expression":{"references":["local.json_map"]},"description":"JSON encoded container definitions for use with other terraform resources such as aws_ecs_task_definition"}},"variables":{"command":{"default":null,"description":"The command that is passed to the container"},"container_cpu":{"default":256,"description":"The number of cpu units to reserve for the container. This is optional for tasks using Fargate launch type and the total amount of container_cpu of all containers in a task will need to be lower than the task-level cpu value"},"container_depends_on":{"default":null,"description":"The dependencies defined for container startup and shutdown. A container can contain multiple dependencies. When a dependency is defined for container startup, for container shutdown it is reversed"},"container_image":{"description":"The image used to start the container. Images in the Docker Hub registry available by default"},"container_memory":{"default":256,"description":"The amount of memory (in MiB) to allow the container to use. This is a hard limit, if the container attempts to exceed the container_memory, the container is killed. This field is optional for Fargate launch type and the total amount of container_memory of all containers in a task will need to be lower than the task memory value"},"container_memory_reservation":{"default":128,"description":"The amount of memory (in MiB) to reserve for the container. If container needs to exceed this threshold, it can do so up to the set container_memory hard limit"},"container_name":{"description":"The name of the container. Up to 255 characters ([a-z], [A-Z], [0-9], -, _ allowed)"},"dns_servers":{"default":null,"description":"Container DNS servers. This is a list of strings specifying the IP addresses of the DNS servers"},"docker_labels":{"default":null,"description":"The configuration options to send to the `docker_labels`"},"entrypoint":{"default":null,"description":"The entry point that is passed to the container"},"environment":{"default":null,"description":"The environment variables to pass to the container. This is a list of maps"},"essential":{"default":true,"description":"Determines whether all other containers in a task are stopped, if this container fails or stops for any reason. Due to how Terraform type casts booleans in json it is required to double quote this value"},"firelens_configuration":{"default":null,"description":"The FireLens configuration for the container. This is used to specify and configure a log router for container logs. For more details, see https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_FirelensConfiguration.html"},"healthcheck":{"default":null,"description":"A map containing command (string), timeout, interval (duration in seconds), retries (1-10, number of times to retry before marking container unhealthy), and startPeriod (0-300, optional grace period to wait, in seconds, before failed healthchecks count toward retries)"},"links":{"default":null,"description":"List of container names this container can communicate with without port mappings"},"log_configuration":{"default":null,"description":"Log configuration options to send to a custom log driver for the container. For more details, see https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_LogConfiguration.html"},"mount_points":{"default":null,"description":"Container mount points. This is a list of maps, where each map should contain a `containerPath` and `sourceVolume`"},"port_mappings":{"default":[{"containerPort":80,"hostPort":80,"protocol":"tcp"}],"description":"The port mappings to configure for the container. This is a list of maps. Each map should contain \"containerPort\", \"hostPort\", and \"protocol\", where \"protocol\" is one of \"tcp\" or \"udp\". If using containers in a task with the awsvpc or host network mode, the hostPort can either be left blank or set to the same value as the containerPort"},"privileged":{"default":null,"description":"When this variable is `true`, the container is given elevated privileges on the host container instance (similar to the root user). This parameter is not supported for Windows containers or tasks using the Fargate launch type. Due to how Terraform type casts booleans in json it is required to double quote this value"},"readonly_root_filesystem":{"default":false,"description":"Determines whether a container is given read-only access to its root filesystem. Due to how Terraform type casts booleans in json it is required to double quote this value"},"repository_credentials":{"default":null,"description":"Container repository credentials; required when using a private repo.  This map currently supports a single key; \"credentialsParameter\", which should be the ARN of a Secrets Manager's secret holding the credentials"},"secrets":{"default":null,"description":"The secrets to pass to the container. This is a list of maps"},"start_timeout":{"default":30,"description":"Time duration (in seconds) to wait before giving up on resolving dependencies for a container"},"stop_timeout":{"default":30,"description":"Time duration (in seconds) to wait before the container is forcefully killed if it doesn't exit normally on its own"},"system_controls":{"default":null,"description":"A list of namespaced kernel parameters to set in the container, mapping to the --sysctl option to docker run. This is a list of maps: { namespace = \"\", value = \"\"}"},"ulimits":{"default":null,"description":"Container ulimit settings. This is a list of maps, where each map should contain \"name\", \"hardLimit\" and \"softLimit\""},"user":{"default":null,"description":"The user to run as inside the container. Can be any of these formats: user, user:group, uid, uid:gid, user:gid, uid:group"},"volumes_from":{"default":null,"description":"A list of VolumesFrom maps which contain \"sourceContainer\" (name of the container that has the volumes to mount) and \"readOnly\" (whether the container can write to the volume)"},"working_directory":{"default":null,"description":"The working directory to run commands inside the container"}}},"version_constraint":"0.21.0"}},"variables":{"command":{"default":null,"description":"(Optional) The command that is passed to the container"},"container_cpu":{"default":1024,"description":"(Optional) The number of cpu units to reserve for the container. This is optional for tasks using Fargate launch type and the total amount of container_cpu of all containers in a task will need to be lower than the task-level cpu value"},"container_depends_on":{"default":null,"description":"(Optional) The dependencies defined for container startup and shutdown. A container can contain multiple dependencies. When a dependency is defined for container startup, for container shutdown it is reversed"},"container_image":{"description":"The image used to start the container."},"container_memory":{"default":8192,"description":"(Optional) The amount of memory (in MiB) to allow the container to use. This is a hard limit, if the container attempts to exceed the container_memory, the container is killed. This field is optional for Fargate launch type and the total amount of container_memory of all containers in a task will need to be lower than the task memory value"},"container_memory_reservation":{"default":2048,"description":"(Optional) The amount of memory (in MiB) to reserve for the container. If container needs to exceed this threshold, it can do so up to the set container_memory hard limit"},"container_name":{"description":"The name of the container. Up to 255 characters ([a-z], [A-Z], [0-9], -, _ allowed)"},"container_port":{"description":"Port on which the container is listening"},"dns_servers":{"default":null,"description":"(Optional) Container DNS servers. This is a list of strings specifying the IP addresses of the DNS servers"},"docker_labels":{"default":null,"description":"(Optional) The configuration options to send to the `docker_labels`"},"entrypoint":{"default":null,"description":"(Optional) The entry point that is passed to the container"},"environment":{"default":null,"description":"(Optional) The environment variables to pass to the container. This is a list of maps"},"essential":{"default":true,"description":"(Optional) Determines whether all other containers in a task are stopped, if this container fails or stops for any reason. Due to how Terraform type casts booleans in json it is required to double quote this value"},"firelens_configuration":{"default":null,"description":"(Optional) The FireLens configuration for the container. This is used to specify and configure a log router for container logs. For more details, see https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_FirelensConfiguration.html"},"healthcheck":{"default":null,"description":"(Optional) A map containing command (string), timeout, interval (duration in seconds), retries (1-10, number of times to retry before marking container unhealthy), and startPeriod (0-300, optional grace period to wait, in seconds, before failed healthchecks count toward retries)"},"links":{"default":null,"description":"(Optional) List of container names this container can communicate with without port mappings"},"log_configuration":{"default":null,"description":"(Optional) Log configuration options to send to a custom log driver for the container. For more details, see https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_LogConfiguration.html"},"mount_points":{"default":null,"description":"(Optional) Container mount points. This is a list of maps, where each map should contain a `containerPath` and `sourceVolume`"},"name_preffix":{"description":"Name preffix for resources on AWS"},"placement_constraints":{"default":[],"description":"(Optional) A set of placement constraints rules that are taken into consideration during task placement. Maximum number of placement_constraints is 10. This is a list of maps, where each map should contain \"type\" and \"expression\""},"profile":{"description":"AWS API key credentials to use"},"proxy_configuration":{"default":[],"description":"(Optional) The proxy configuration details for the App Mesh proxy. This is a list of maps, where each map should contain \"container_name\", \"properties\" and \"type\""},"readonly_root_filesystem":{"default":false,"description":"(Optional) Determines whether a container is given read-only access to its root filesystem. Due to how Terraform type casts booleans in json it is required to double quote this value"},"region":{"description":"AWS Region the infrastructure is hosted in"},"repository_credentials":{"default":null,"description":"(Optional) Container repository credentials; required when using a private repo.  This map currently supports a single key; \"credentialsParameter\", which should be the ARN of a Secrets Manager's secret holding the credentials"},"secrets":{"default":null,"description":"(Optional) The secrets to pass to the container. This is a list of maps"},"start_timeout":{"default":30,"description":"(Optional) Time duration (in seconds) to wait before giving up on resolving dependencies for a container."},"stop_timeout":{"default":30,"description":"(Optional) Timeout in seconds between sending SIGTERM and SIGKILL to container"},"system_controls":{"default":null,"description":"(Optional) A list of namespaced kernel parameters to set in the container, mapping to the --sysctl option to docker run. This is a list of maps: { namespace = \"\", value = \"\"}"},"ulimits":{"default":null,"description":"(Optional) Container ulimit settings. This is a list of maps, where each map should contain \"name\", \"hardLimit\" and \"softLimit\""},"user":{"default":null,"description":"(Optional) The user to run as inside the container. Can be any of these formats: user, user:group, uid, uid:gid, user:gid, uid:group"},"volumes_from":{"default":null,"description":"(Optional) A list of VolumesFrom maps which contain \"sourceContainer\" (name of the container that has the volumes to mount) and \"readOnly\" (whether the container can write to the volume)"},"working_directory":{"default":null,"description":"(Optional) The working directory to run commands inside the container"}}},"version_constraint":"1.0.7"}},"variables":{"container_image":{"description":"The image used to start the container."},"container_port":{"description":"Port on which the container is listening"},"log_group_path":{"description":"Log Group Path"},"name_preffix":{"description":"Name preffix for resources on AWS"},"profile":{"description":"AWS API key credentials to use"},"region":{"description":"AWS Region where the infrastructure is hosted in"}}}}}
